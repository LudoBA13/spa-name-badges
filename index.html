<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Name Badge Generator</title>
	<style>
		@import url('https://fonts.googleapis.com/css2?family=Open+Sans+Condensed:wght@300;700&display=swap');
		body
		{
			font-family: sans-serif;
			display: flex;
		}
		body,
		div
		{
			margin:  0;
			padding: 0;
		}
		#page
		{
			background-color: #fff;
			min-height: 297mm;
			width: 210mm;
			overflow: auto;
		}
		.badge
		{
			box-sizing: border-box;
			border-bottom: 1px solid #00000040;
			border-right:  1px solid #00000040;
			display: flex;
			flex-direction: column;
			float:         left;
			font-family:   "Open Sans Condensed";
			font-size:     24pt;
			height:        59.4mm;
			line-height:   90%;
			margin:        0;
			text-align:    center;
			width:         88mm;
		}
		.badge .head
		{
			box-sizing: border-box;
			display:    flex;
			height:     40%;
			padding:    5mm;
		}
		.badge .logo-text
		{
			font-size: 96%;
			flex-grow: 1;
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: bold;
			color: #ff8200;
		}
		.badge .logo
		{
			height: 100%;
			width: auto;
		}
		.badge .body
		{
			box-sizing: border-box;
			display: flex;
			flex-direction: column;
			justify-content: space-evenly;
			align-items: center;
			height: 60%;
			padding: 0 5mm;
		}
		.badge .name
		{
			font-size: 125%;
			font-weight: bold;
			line-height: 100%;
		}
		.badge .title
		{
			font-size: 92%;
			font-weight: 300;
		}
		@media screen
		{
			body
			{
				height: 100vh;
			}
			#input-zone
			{
				flex: 1;
				padding: 1rem;
				display: flex;
				flex-direction: column;
			}
			#input-zone textarea
			{
				flex: 1;
				resize: none;
				font-family: monospace;
			}
			#page
			{
				margin: 1rem auto;
				box-shadow: 0 0 .5cm #00000080;
			}
			#preview-zone
			{
				flex: 2;
				padding: 1rem;
				background-color: #f0f0f0;
				overflow: auto;
			}
		}
		@media print
		{
			#page
			{
				print-color-adjust: exact;
			}
			.badge
			{
				page-break-inside: avoid;
			}
			.screen-only
			{
				display: none;
			}
		}
	</style>
</head>
<body>
	<div id="input-zone" class="screen-only">
		<h2>Input Names</h2>
		<textarea id="name-input" placeholder="Enter one name per line"></textarea>
	</div>
	<div id="preview-zone">
		<h2 class="screen-only">Preview</h2>
		<div id="page"></div>
	</div>
	<script>
		const nameInput = document.getElementById('name-input');
		const page      = document.getElementById('page');
		let debounceTimer;

		nameInput.addEventListener('input', schedulePreview);
		nameInput.addEventListener('keydown', function(e)
		{
			if (e.key == 'Tab')
			{
				e.preventDefault();
				const start = this.selectionStart;
				const end   = this.selectionEnd;

				// set textarea value to: text before caret + tab + text after caret
				this.value = this.value.substring(0, start) +
				"\t" + this.value.substring(end);

				// put caret at right position again
				this.selectionStart =
				this.selectionEnd = start + 1;
				schedulePreview();
			}
		});

		function formatName(lastName, firstName)
		{
			lastName  = lastName.trim().toUpperCase();
			firstName = firstName.trim().toLowerCase().replace(
				/(^|\P{L})\p{L}/gu,
				str => str.toUpperCase()
			);

			return lastName + ' ' + firstName;
		}

		function formatTitle(title)
		{
			return title.trim().replace(/^\p{L}/u, str => str.toUpperCase());
		}

		function schedulePreview()
		{
			clearTimeout(debounceTimer);
			debounceTimer = setTimeout(updatePreview, 300);
		}

		function parseLine(line)
		{
			const [lastName = '', firstName = '', title = ''] = line.split("\t");

			return {
				name:  formatName(lastName, firstName),
				title: formatTitle(title)
			};
		}

		function updatePreview()
		{
			page.innerHTML = '';

			const lines  = nameInput.value.split("\n");
			const badges = lines.map(parseLine).sort((a, b) => a.name > b.name);

			for (const badgeInfo of badges)
			{
				const badge = createBadge(badgeInfo.name, badgeInfo.title);
				page.appendChild(badge);
			}
		}

		function createDiv(className)
		{
			const div = document.createElement('div');
			div.className = className;

			return div;
		}

		const badgeHeader = createDiv('head');
		function setBadgeHeader(logoSrc, logoText)
		{
			badgeHeader.innerHTML = '';

			if (logoSrc > '')
			{
				const img = document.createElement('img');
				img.className = 'logo';
				img.src       = logoSrc;

				badgeHeader.append(img);
			}
			if (logoText > '')
			{
				const div = createDiv('logo-text');
				div.textContent = logoText;

				badgeHeader.append(div);
			}
		}
		setBadgeHeader('https://ba13.banquealimentaire.org/sites/default/files/styles/local_homepage_logo/public/2019-02/Logo%20Banque%20Alimentaire%2013%20(fond%20transparent).png', '');

		// dev only
		setBadgeHeader('cafe.png', 'CAFÉ DE RENTRÉE');

		function createBadge(badgeName, badgeTitle)
		{
			const badge    = createDiv('badge');
			const head     = badgeHeader.cloneNode(true);
			const body     = createDiv('body');
			const name     = createDiv('name');
			const title    = createDiv('title');

			name.textContent = badgeName;
			title.textContent = badgeTitle;

			body.append(name, title);
			badge.append(head, body);

			return badge;
		}

		// Initial preview update
		updatePreview();
	</script>
</body>
</html>
