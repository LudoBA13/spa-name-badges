<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Name Badge Generator</title>
	<style>
		body
		{
			font-family: sans-serif;
			display: flex;
		}
		body,
		div
		{
			margin:  0;
			padding: 0;
		}
		#page
		{
			background-color: #fff;
			min-height: 297mm;
			width: 210mm;
		}
		.badge
		{
			border-bottom: 1px solid #00000040;
			border-right:  1px solid #00000040;
			float:         left;
			font-size:     24pt;
			height:        60mm;
			line-height:   80%;
			margin:        0;
			text-align:    center;
			width:         88mm;
		}
		@media screen
		{
			body
			{
				height: 100vh;
			}
			#input-zone
			{
				flex: 1;
				padding: 1rem;
				display: flex;
				flex-direction: column;
			}
			#input-zone textarea
			{
				flex: 1;
				resize: none;
				font-family: monospace;
			}
			#page
			{
				margin: 1rem auto;
				box-shadow: 0 0 .5cm #00000080;
			}
			#preview-zone
			{
				flex: 2;
				padding: 1rem;
				background-color: #f0f0f0;
				overflow: auto;
			}
		}
		@media print
		{
			#page
			{
				print-color-adjust: exact;
			}
			.badge
			{
				page-break-inside: avoid;
			}
			.screen-only
			{
				display: none;
			}
		}
	</style>
</head>
<body>
	<div id="input-zone" class="screen-only">
		<h2>Input Names</h2>
		<textarea id="name-input" placeholder="Enter one name per line"></textarea>
	</div>
	<div id="preview-zone">
		<h2 class="screen-only">Preview</h2>
		<div id="page"></div>
	</div>
	<script>
		const nameInput = document.getElementById('name-input');
		const page      = document.getElementById('page');
		let debounceTimer;

		nameInput.addEventListener('input', schedulePreview);
		nameInput.addEventListener('keydown', function(e)
		{
			if (e.key == 'Tab')
			{
				e.preventDefault();
				const start = this.selectionStart;
				const end   = this.selectionEnd;

				// set textarea value to: text before caret + tab + text after caret
				this.value = this.value.substring(0, start) +
				"\t" + this.value.substring(end);

				// put caret at right position again
				this.selectionStart =
				this.selectionEnd = start + 1;
				schedulePreview();
			}
		});

		function formatName(lastName, firstName)
		{
			lastName  = lastName.trim().toUpperCase();
			firstName = firstName.trim().toLowerCase().replace(
				/(^|\P{L})\p{L}/gu,
				str => str.toUpperCase()
			);

			return lastName + ' ' + firstName;
		}

		function formatTitle(title)
		{
			return title.trim().replace(/^\p{L}/u, str => str.toUpperCase());
		}

		function schedulePreview()
		{
			clearTimeout(debounceTimer);
			debounceTimer = setTimeout(updatePreview, 300);
		}

		function parseLine(line)
		{
			const [lastName = '', firstName = '', title = ''] = line.split("\t");

			return {
				name:  formatName(lastName, firstName),
				title: formatTitle(title)
			};
		}

		function updatePreview()
		{
			// Clear previous preview
			page.innerHTML = '';

			for (const line of nameInput.value.split("\n"))
			{
				const badgeInfo = parseLine(line);
				const badge     = createBadge(badgeInfo.name, badgeInfo.title);

				page.appendChild(badge);
			}
		}

		function createDiv(className)
		{
			const div = document.createElement('div');
			div.className = className;

			return div;
		}

		function createBadge(badgeName, badgeTitle)
		{
			const badge  = createDiv('badge');
			const header = createDiv('header');
			const body   = createDiv('body');
			const name   = createDiv('name');
			const title  = createDiv('title');

			name.textContent = badgeName;
			title.textContent = badgeTitle;

			body.append(name, title);
			badge.append(header, body);

			return badge;
		}

		// Initial preview update
		updatePreview();
	</script>
</body>
</html>
